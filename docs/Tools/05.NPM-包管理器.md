---
title: NPM包管理器
date: '2021-10-21 10:34:30'
sidebar: 'auto'
categories:
 - 命令行
tags:
 - Cli
 - Tool
---

# NPM介绍

## NPM简介

**npm**（全称 Node Package Manager，即“node包管理器”）是[Node.js](https://zh.wikipedia.org/wiki/Node.js)默认的、用[JavaScript](https://zh.wikipedia.org/wiki/JavaScript)编写的[软件包管理系统](https://zh.wikipedia.org/wiki/軟體套件管理系統)。npm会随着Node.js自动安装。npm模块仓库提供了一个名为“registry”的查询服务，用户可通过本地的npm命令下载并安装指定模块。此外用户也可以通过npm把自己设计的模块分发到registry上面

## NPM的由来

npm完全用[JavaScript](https://zh.wikipedia.org/wiki/JavaScript)写成，最初由艾萨克·施吕特（Isaac Z. Schlueter）开发。艾萨克表示自己意识到“模块管理很糟糕”的问题，并看到了[PHP](https://zh.wikipedia.org/wiki/PHP)的[PEAR](https://zh.wikipedia.org/wiki/PEAR)与[Perl](https://zh.wikipedia.org/wiki/Perl)的[CPAN](https://zh.wikipedia.org/wiki/CPAN)等软件的缺点，于是编写了npm。

# NPM的命令行使用

基础命令的使用方法

```bash
$ npm <命令> [参数] 
```

## *登录/组织登录

```bash
# 组织登录
$ npm login # 登录当前用户
$ npm adduser # login的别名
$ npm login --scope=@组织名称

# 注销，删除链接和身份验证令牌
$ npm logout # 注销当前用户
$ npm logout --scope=@组织名称
```

指定注册地址

```bash
# 可选参数 注册地址
# --registry=https://registry.mycorp.com
$ npm login --registry=https://registry.npmjs.org
```

## *初始化/组织初始化

初始化生成一个包，可以理解为create...

```bash
# 初始化生成包
$ npm init
# 指定组织进行初始化 --yes的别名>表示跳过问卷
$ npm init --scope=@组织名称 -y
```

## *快速构建项目

该功能与Yarn Create相同,是一个速记命令，能一次性帮您完成两件事情

```bash
# 仅举例，无法使用
$ npm init pkg [<args>]
# 与下方命令一致
$ npm i -g create-pkg && create-pkg [<args>]
# 实际的命令转换其实是
$ npm exec create-pkg [<args>]
# 因为 npm exec|npm x|npx其实是相同的所以..
$ npx create-pkg [<args>]
```

可用例子

```bash
$ npm init vite vite-app
```

init命令转化为相应的`npm exec`操作如下：

- `npm init foo` -> `npm exec create-foo`
- `npm init @usr/foo` -> `npm exec @usr/create-foo`
- `npm init @usr` -> `npm exec @usr/create`

## 工作区初始化

> ~~什么是工作区?(暂无)~~

```bash
# 初始化一个工作区
$ npm init -w <dir>
# 通常来说都会以 packages/xxx作为工作区
$ npm init -w packages/pkg-name
```

> 快速构建工作区项目

```bash
# 先指定工作区， 后init快速初始化项目
$ npm init <workspace-option> pkg [<args>]
# 示例 init --workspace别名 workspace目录 viteCli 创建到当前目录
$ npm init -w packages/ws-vite vite .
```

## *添加/清除缓存

add/添加：将指定的包添加到本地缓存。此命令主要供 npm 内部使用，但它可以提供一种将数据显式添加到本地安装缓存的方法。

> 感知不强

```bash
$ npm cache add <pkg-name>
```

clean/清除：删除缓存文件夹中的所有数据。请注意，这通常是不必要的，因为 npm 的缓存是自我修复的并且可以抵抗数据损坏问题。

> 目测尝试只能全部删除,不能指定

```bash
$ npm cache clean
$ npm cache clear
$ npm cache rm
```

ls/列表：查看npm缓存列表

```bash
$ npm cache ls
```

verify/验证：验证缓存文件夹的内容，垃圾收集任何不需要的数据，并验证缓存索引和所有缓存数据的完整性

```bash
$ npm cache verify
```

## *快速打开包issues

快速到包的仓库，查看issues，解决/提出问题

```bash
$ npm bugs <pkg-name>
```

## 使用锁快速安装

`npm ci` 在以下情况下会明显更快：

- 有一个`package-lock.json`或`npm-shrinkwrap.json`文件。
- 该`node_modules`文件夹丢失或为空。

```bash
$ npm ci
```

简而言之，使用`npm install`和之间的主要区别`npm ci`是：

- 该项目**必须**具有现有的`package-lock.json`或 `npm-shrinkwrap.json`.
- 如果包锁中的依赖项与 中的不匹配`package.json`， `npm ci`将退出并显示错误，而不是更新包锁。
- `npm ci` 一次只能安装整个项目：无法使用此命令添加单个依赖项。
- 如果 a`node_modules`已经存在，它将在`npm ci`开始安装之前自动删除。
- 它永远不会写入`package.json`或任何包锁：安装基本上是冻结的。

## 命令存放位置

```bash
# 打印全局存放位置
$ npm bin -g
# 打印当前项目存放位置
$ npm bin
```

# NPX

## NPX简介

npx原本是npm团队独立出来的一个npm包，用途是操作当前项目中的命令。后来npm将npx合并了，安装node时也会预置npx。在后续的版本中 npm也拥有 exec和 x等命令可直接代替npx

## *NPX的工作方式

1.先搜索当前的项目node_modules/.bin中是否存在需要执行的命令

2.再到比本地的全局搜索是否存在需要执行的命令

3.如果项目和本地的全局都没有能够执行的命令，会缓存一个文件夹，下载命令去执行，但执行完成后将删除缓存的文件夹



